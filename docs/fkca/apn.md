# APN

## APN 与移动网络的连接流程（简化版）

1. 手机开启移动数据 → 向运营商网络发送连接请求，附带 APN 配置。
2. 运营商的核心网（SGSN/MME）收到 APN → 通过 DNS 解析找到对应的网关（GGSN/PGW）。
3. 网关根据 APN 决定：
    * 连接公网互联网（普通上网）
    * 连接企业专网（私有 APN）
    * 分配 IP、QoS（服务质量）、计费规则等

连接成功 → 手机获得 IP 地址，开始上网。

| 作用             | 说明                                                                 |
|------------------|----------------------------------------------------------------------|
| 标识接入路径     | 告诉运营商的网关（GGSN/PGW）设备要连接哪个外部网络（如互联网、MMS、WAP、企业专网等） |
| 分配 IP 地址     | 决定设备获得公网 IP 还是私网 IP，以及 IP 地址类型（动态/静态）       |
| 决定服务类型     | 区分普通上网、MMS、多媒体消息、定位服务等                           |
| 控制安全与路由   | 私网 APN 可实现数据直连企业内网、加密传输、防火墙隔离等             |
| 运营商区分       | 每个运营商的 APN 不同（如中国移动常用 cmnet、cmwap，中国联通 3gnet、uniwap，中国电信 ctnet、ctwap） |


没有正确的 APN 配置 → 无法使用移动数据（即使信号满格）。APN 是移动网络数据服务的“入口”，直接决定了设备能访问什么网络、速度、安全性、计费方式。大多数情况下，插入 SIM 卡后手机会自动配置正确的 APN（运营商推送），但换卡、换设备、用物联网卡、去国外漫游、需要专网时，可能需要手动设置或修改。


```mermaid
flowchart TD
    subgraph A [用户设备]
        direction LR
        A1[手机/蜂窝网络版平板]
        A2[电脑/手机连接Wi-Fi时]
    end

    subgraph B1 [移动数据上网路径]
        direction TB
        B1_1[手机调制解调器] --> B1_2[USIM卡<br>存储IMSI、认证密钥]
        B1_2 --> B1_3{APN设置<br>（如cmnet）<br>决定接入的网络类型}
    end

    subgraph B2 [Wi-Fi上网路径]
        B2_1[Wi-Fi网卡] --> B2_2[路由器/热点]
    end

    A1 --> B1
    A2 --> B2

    B1_3 --> C
    B2_2 --> C

    subgraph C [首次接入与核心网]
        C1[无线电信号连接] --> C2[基站<br>（铁塔上的天线）]
        C2 --> C3[基站控制器]
        C3 --> C4[移动核心网<br>（MME, HSS, SGW, PGW）]
        C4 -- “通过APN选择” --> C5[互联网接入点<br>（ISP网络）]
    end

    C5 --> D[公共互联网]

    D --> E[目标网站/服务器]

    subgraph F [可选安全叠加层：VPN]
        F1[设备上的VPN客户端] -- 加密所有数据 --> F2[VPN隧道<br>（覆盖在原有连接之上）]
        F2 --> F3[企业VPN网关<br>或公共VPN服务器]
        F3 -- 解密后访问 --> E2[内网资源<br>或互联网]
    end

    E -.-> F
```
